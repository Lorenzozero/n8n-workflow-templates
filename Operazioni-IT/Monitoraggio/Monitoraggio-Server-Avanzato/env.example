# Configurazione Monitoraggio Server Avanzato
# Copia questo file in .env e personalizza i valori

# ===== CONFIGURAZIONE n8n =====
N8N_DEFAULT_LOCALE=it
TZ=Europe/Rome
N8N_LOG_LEVEL=info

# ===== CREDENZIALI SLACK =====
# Ottenere da: https://api.slack.com/apps > Your App > OAuth & Permissions
SLACK_BOT_TOKEN=xoxb-your-slack-bot-token-here
SLACK_CHANNEL_ALERTS=#alerts-it
SLACK_USERNAME=Sistema Monitoraggio IT

# Rate Limiting Slack
# Max 1 messaggio per secondo per canale
SLACK_RATE_LIMIT=1000

# ===== CREDENZIALI EMAIL =====
# Configurazione Gmail OAuth2 (raccomandato)
GMAIL_CLIENT_ID=your-gmail-client-id
GMAIL_CLIENT_SECRET=your-gmail-client-secret
GMAIL_REFRESH_TOKEN=your-gmail-refresh-token

# Alternativa: SMTP Standard
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=monitoring@azienda.it
SMTP_PASS=your-app-specific-password

# Destinatari email alerts
EMAIL_DESTINATARIO_PRIMARIO=sysadmin@azienda.it
EMAIL_DESTINATARIO_SECONDARIO=manager@azienda.it
EMAIL_CC=team-it@azienda.it

# ===== PAGERDUTY INTEGRATION =====
# Ottenere da: PagerDuty > Services > Your Service > Integrations
PAGERDUTY_ROUTING_KEY=your-pagerduty-routing-key
PAGERDUTY_SERVICE_ID=your-service-id
PAGERDUTY_WEBHOOK_URL=https://events.pagerduty.com/v2/enqueue

# Rate Limiting PagerDuty
# Max 120 eventi per minuto per service
PAGERDUTY_RATE_LIMIT=120

# ===== CONFIGURAZIONE SERVER TARGET =====
# Server primario di produzione
SERVER_PRIMARY_NAME=Server Produzione Web
SERVER_PRIMARY_URL=https://app.azienda.it
SERVER_PRIMARY_HOST=10.0.1.100
SERVER_PRIMARY_SSH_PORT=22
SERVER_PRIMARY_SSH_USER=monitoring

# Server secondario (opzionale)
SERVER_SECONDARY_NAME=Server Database
SERVER_SECONDARY_URL=https://db.azienda.it:5432
SERVER_SECONDARY_HOST=10.0.1.101

# Credenziali SSH
# Usare chiave SSH Ã¨ raccomandato per sicurezza
SSH_PRIVATE_KEY_PATH=/path/to/monitoring-key.pem
# Alternativa: password (meno sicuro)
SSH_PASSWORD=your-ssh-password

# Timeout connessioni
SSH_TIMEOUT=30000
HTTP_TIMEOUT=30000

# ===== SOGLIE DI ALERT =====
# Soglie CPU (percentuale)
SOGLIA_CPU_WARNING=70
SOGLIA_CPU_CRITICAL=85
SOGLIA_CPU_EMERGENCY=95

# Soglie Memoria (percentuale)
SOGLIA_MEMORIA_WARNING=80
SOGLIA_MEMORIA_CRITICAL=90
SOGLIA_MEMORIA_EMERGENCY=95

# Soglie Disco (percentuale)
SOGLIA_DISCO_WARNING=75
SOGLIA_DISCO_CRITICAL=85
SOGLIA_DISCO_EMERGENCY=95

# Soglie Response Time (millisecondi)
SOGLIA_RESPONSE_TIME_WARNING=2000
SOGLIA_RESPONSE_TIME_CRITICAL=5000

# ===== CONFIGURAZIONE MONITORAGGIO =====
# Intervallo controlli (cron format)
# Ogni 5 minuti: "*/5 * * * *"
# Ogni minuto: "* * * * *"
# Ogni 15 minuti: "*/15 * * * *"
MONITORING_CRON_SCHEDULE=*/5 * * * *

# Retry logic
MAX_RETRY_ATTEMPTS=3
RETRY_DELAY_MS=5000

# Timeout health check
HEALTH_CHECK_TIMEOUT=30000

# ===== PERSONALIZZAZIONE MESSAGGI =====
# Template messaggio Slack alert critico
SLACK_MESSAGE_TEMPLATE="ðŸš¨ ALERT CRITICO: Server {{server_name}} Ã¨ offline!\n\nDettagli:\n- URL: {{server_url}}\n- Timestamp: {{timestamp}}\n- Codice risposta: {{status_code}}\n\nAzione richiesta: Verifica immediata dell'infrastruttura."

# Template oggetto email
EMAIL_SUBJECT_TEMPLATE="ðŸ”´ ALERT SISTEMA: {{alert_type}} su {{server_name}}"

# ===== CONFIGURAZIONE AVANZATA =====
# Abilitazione logging dettagliato
ENABLE_DEBUG_LOGGING=false

# Abilitazione metriche storiche (richiede storage aggiuntivo)
ENABLE_HISTORICAL_METRICS=true

# Retention metriche storiche (giorni)
METRICS_RETENTION_DAYS=30

# Abilitazione throttling alert (evita spam)
ENABLE_ALERT_THROTTLING=true
ALERT_THROTTLING_MINUTES=15

# ===== WHITELIST E SICUREZZA =====
# IP whitelist per connessioni SSH (comma separated)
SSH_WHITELIST_IPS=192.168.1.0/24,10.0.0.0/8

# User agent per health check HTTP
HTTP_USER_AGENT=n8n-monitoring-bot/1.0

# Headers custom per health check
HTTP_CUSTOM_HEADERS={"X-Monitoring": "n8n", "X-Source": "internal"}

# ===== NOTE CONFIGURAZIONE =====
# 
# IMPORTANTE:
# 1. Non committare mai questo file con credenziali reali
# 2. Usare sempre variabili d'ambiente in produzione
# 3. Testare tutte le connessioni prima di attivare il workflow
# 4. Configurare rotate delle chiavi SSH periodicamente
# 5. Monitorare i rate limit dei servizi esterni
#
# PERMESSI RICHIESTI:
# - Slack: chat:write, channels:read
# - Gmail: https://www.googleapis.com/auth/gmail.send
# - SSH: accesso read-only con comandi system info
# - PagerDuty: Events API v2 access
#
# TROUBLESHOOTING:
# - Testare connessioni manualmente prima dell'automazione
# - Verificare firewall e network policies
# - Controllare logs n8n per dettagli errori
# - Usare "Execute Workflow" per test isolati
#
# SUPPORTO:
# - Documentazione: https://wiki.azienda.it/n8n-monitoring
# - Tickets: support@azienda.it
# - Slack: #n8n-support